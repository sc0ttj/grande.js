(function(){function a(){if(!r){r=!0;var a=y.createElement("div"),b="<div class='g-options'>           <span class='no-overflow'>             <span class='ui-inputs'>               <button class='bold'>B</button>               <button class='italic'>i</button>               <button class='quote'>&rdquo;</button>               <button class='url'>&#128279;</button>               <input class='url-input' type='text' placeholder='Paste or type a link'/>             </span>           </span>         </div>",c=y.createElement("div");c.className="g-options-container",y.querySelectorAll(".g-options-container").length<1&&y.body.appendChild(c),a.className="text-menu hide",a.innerHTML=b,0===y.querySelectorAll(".text-menu").length&&c.appendChild(a),s=y.querySelectorAll(".text-menu")[0],t=y.querySelectorAll(".text-menu .g-options")[0],u=y.querySelectorAll(".text-menu .url-input")[0]}}function b(){selectionchange&&selectionchange.start(),y.addEventListener("selectionchange",p),x.addEventListener("resize",p),u.addEventListener("blur",h),u.addEventListener("keydown",i)}function c(a){var b,c,d,e=y.querySelectorAll(".text-menu button"),f=function(b){a(b)};for(b=0,c=e.length;b<c;b++)d=e[b],f(d)}function d(){c(function(a){a.onmousedown=function(b){g(a)}})}function e(){return x.getSelection().focusNode}function f(){var a,b,d,f=e();c(function(c){a=c.className;for(var e in B)if(b=B[e],d=new RegExp(b),d.test(a)){n(f,e)?c.className=b+" active":c.className=b;break}})}function g(a){var b,c,d=a.className,e=window.getSelection(),f=e.anchorNode;for(var g in B)if(b=B[g],c=new RegExp(b),c.test(d))switch(g){case"b":return void(!f||n(f,"h1")||n(f,"h2")||y.execCommand(b,!1));case"i":return void y.execCommand(b,!1);case"h1":case"h2":case"h3":case"blockquote":return void j(g);case"a":return k(),void(t.className="g-options url-mode")}p()}function h(a){var b=u.value;return t.className="g-options",v&&window.getSelection().addRange(v),y.execCommand("unlink",!1),""===b?(v=void 0,!1):(b.match("^(http://|https://|mailto:)")||(b="http://"+b),y.execCommand("createLink",!1,b),v=void 0,void(u.value=""))}function i(a){13===a.keyCode&&(a.preventDefault(),a.stopPropagation(),u.blur())}function j(a){n(e(),a)?(y.execCommand("formatBlock",!1,"p"),y.execCommand("outdent")):y.execCommand("formatBlock",!1,a)}function k(){setTimeout(function(){var a=o(e());"undefined"!=typeof a?u.value=a:y.execCommand("createLink",!1,"/"),v=window.getSelection().getRangeAt(0),u.focus()},150)}function l(a,b,c){if(null!==a)for(;a.parentNode;){if(b(a))return c(a);a=a.parentNode}}function m(a,b){var c=function(a){return a.nodeName.toLowerCase()===b},d=function(a){return a};return l(a,c,d)}function n(a,b){return!!m(a,b)}function o(a){var b=function(a){return"undefined"!=typeof a.href},c=function(a){return a.href};return l(a,b,c)}function p(a){var b,c,d=x.getSelection(),e=(a.target||{}).activeElement||a.target||a.srcElement||y.activeElement;v||(!e.isContentEditable||d.isCollapsed?(q(w,w),s.className="text-menu hide",f()):(b=d.getRangeAt(0),c=b.getBoundingClientRect(),f(),q(c.bottom+55+ +x.pageYOffset,(c.left+c.right)/2)))}function q(a,b){s.style.top=a+"px",s.style.left=b+25+"px",A.animate&&(a===w?s.className="text-menu hide":s.className="text-menu active")}var r,s,t,u,v,w=-999,x=this,y=this.document,z=y.querySelectorAll(".g-body article"),A=(z[0],navigator.userAgent.toLowerCase().indexOf("firefox")>-1,{animate:!0}),B={b:"bold",i:"italic",a:"url",blockquote:"quote"};x.grande={bind:function(c,e){c&&(z=c),A=e||A,a(),b(),d()},select:function(){p()}}}).call(this);var selectionchange=function(a){function b(b){var c=b.onselectionchange;if(c!==a)try{return b.onselectionchange=0,null===b.onselectionchange}catch(a){}finally{b.onselectionchange=c}return!1}function c(){return"undefined"!=typeof WeakMap?new WeakMap:(console.error("selectionchange: WeakMap not supported"),null)}function d(a){var b=a.getSelection();return b.rangeCount?b.getRangeAt(0):null}function e(a,b,c){a.addEventListener(b,c,!0)}function f(a,b,c){a.removeEventListener(b,c,!0)}function g(a){var b=a.keyCode;(65===b&&a[o]&&!a.shiftKey&&!a.altKey||b<=40&&b>=37&&a.shiftKey)&&setTimeout(l.bind(null,this),0)}function h(a){0===a.button&&(e(this,"mousemove",i),setTimeout(l.bind(null,this),0))}function i(a){1&a.buttons?l(this):f(this,"mousemove",i)}function j(a){0===a.button?setTimeout(l.bind(null,this),0):f(this,"mousemove",i)}function k(){setTimeout(l.bind(null,this.document),0)}function l(a){var b=n.get(a),c=d(a);m(c,b)||(n.set(a,c),setTimeout(a.dispatchEvent.bind(a,new Event("selectionchange")),0))}function m(a,b){return a===b||a&&b&&p.every(function(c){return a[c]===b[c]})}var n,o=/^Mac/.test(navigator.platform)?"metaKey":"ctrlKey",p=["startContainer","startOffset","endContainer","endOffset"];return{start:function(a){var f=a||document;(n||!b(f)&&(n=c()))&&(n.has(f)||(n.set(f,d(f)),e(f,"keydown",g),e(f,"mousedown",h),e(f,"mousemove",i),e(f,"mouseup",j),e(f.defaultView,"focus",k)))},stop:function(a){var b=a||document;n&&n.has(b)&&(n.delete(b),f(b,"keydown",g),f(b,"mousedown",h),f(b,"mousemove",i),f(b,"mouseup",j),f(b.defaultView,"focus",k))}}}();